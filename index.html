<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="https://glitch.com/favicon.ico">
    <title>Magic Spell Casting Game</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script>
        // Extended A-Frame Custom Component for Shooting Spell
        AFRAME.registerComponent('cast-spell', {
            init: function() {
                this.el.addEventListener('click', () => {
                    const spell = document.querySelector('#spell');
                    const enemy = document.querySelector('#enemy');

                    // Calculate direction towards the enemy
                    const directionVec = new THREE.Vector3();
                    enemy.object3D.getWorldPosition(directionVec);
                    directionVec.sub(this.el.object3D.getWorldPosition()).normalize();

                    // Set the spell's position and direction
                    spell.setAttribute('position', this.el.getAttribute('position'));
                    spell.setAttribute('velocity', directionVec.multiplyScalar(5)); // Speed of the spell
                    spell.play(); // Start the animation if paused
                });
            }
        });

        // Component for moving the spell
        AFRAME.registerComponent('velocity', {
            schema: {type: 'vec3'},
            tick: function(time, timeDelta) {
                var position = this.el.getAttribute('position');

                position.x += this.data.x * timeDelta / 1000;
                position.y += this.data.y * timeDelta / 1000;
                position.z += this.data.z * timeDelta / 1000;

                this.el.setAttribute('position', position);
            }
        });
    </script>
</head>
<body>
    <a-scene>
        <a-sky color="#ECECEC"></a-sky>

        <!-- Wizard Object -->
        <a-cylinder id="wizard" position="-1 0.5 -3" radius="0.5" height="1" color="blue"></a-cylinder>

        <!-- Enemy Object -->
        <a-box id="enemy" position="3 0.5 -3" depth="0.5" height="0.5" width="0.5" color="red"></a-box>

        <!-- Spell Projectile -->
        <a-sphere id="spell" position="-1 0.5 -3" radius="0.1" color="yellow" velocity=""></a-sphere>

        <a-camera>
            <a-cursor color="#4CC3D9"></a-cursor>
        </a-camera>
    </a-scene>
</body>
</html>
