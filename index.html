<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="https://glitch.com/favicon.ico">
    <title>Magic Spell Casting Game</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>

<script>
window.addEventListener('load', () => {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        console.log("Speech recognition supported.");
        const recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.start();

        recognition.onresult = (event) => {
            const lastResult = event.results[event.results.length - 1];
            if (lastResult.isFinal) {
                const command = lastResult[0].transcript.trim().toLowerCase();
                console.log("Command heard:", command);
                executeSpell(command);
            }
        };

        recognition.onerror = (event) => {
            console.error("Speech recognition error:", event.error);
        };

        recognition.onend = () => {
            recognition.start(); // Restart recognition
        };
    } else {
        console.log("Speech recognition not supported in this browser.");
    }
});

function executeSpell(command) {
    switch (command) {
        case "background":
            changeBackground();
            break;
        case "dog spell":
            launchProjectile(transformToDog);
            break;
        case "cat spell":
            launchProjectile(transformToCat);
            break;
        case "reverse spell":
            launchProjectile(transformBack);
            break;
        case "shrink spell":
            adjustWizardSize(0.005); // Half the original size
            showMessage("The shrink spell was cast perfectly");
            break;
        case "grow spell":
            adjustWizardSize(0.05); // Double the original size
            showMessage("The Grow spell was cast perfectly");
            break;
        case "normal size spell":
            resetWizardSize(); // Reset to original size
            showMessage("The Wizard went back to its original size perfectly");
            break;


        default:
            console.log("Command not recognized.");
            break;
    }
}


function launchProjectile(callback) {
    const sceneEl = document.querySelector('a-scene');
    const projectile = document.createElement('a-gltf-model');

    projectile.setAttribute('src', 'https://cdn.glitch.global/15d883af-d2cb-46d5-ae7f-907d434c5fdf/scene2.gltf?v=1708488354878');
    projectile.setAttribute('position', '-2 0.5 -3.5'); // Adjust to match the wizard's position
    projectile.setAttribute('scale', '0.005 0.005 0.005'); // Adjust the size of the projectile
    projectile.setAttribute('rotation', '0 250 0');

    // Set the animation to move the projectile towards the enemy's position
    projectile.setAttribute('animation', 'property: position; to: 3 1 -4.5; dur: 1000; easing: linear;');

    sceneEl.appendChild(projectile);

    // Wait for the animation to complete before executing the transformation
    setTimeout(() => {
        sceneEl.removeChild(projectile); // Remove the projectile
        callback(); // Execute the transformation callback
    }, 1000); // This matches the duration of the projectile's animation
}

function changeBackground() {
    const enemy = document.querySelector('#enemy');
    const sky = document.querySelector('a-sky');
    const color = getRandomColor();
    sky.setAttribute('color', color);
    showMessage("The Background spell was cast perfectly");

}

function transformToDog() {
    const enemy = document.querySelector('#enemy');
    if (enemy) {
        enemy.setAttribute('gltf-model', 'https://cdn.glitch.global/15d883af-d2cb-46d5-ae7f-907d434c5fdf/scene5.gltf?v=1708493195785');
        enemy.setAttribute('scale', '1 1 1');
        enemy.setAttribute('position', '3 1.2 -4.5');
        showMessage("The Dog spell was cast perfectly");

    }
}

function transformToCat() {
    const enemy = document.querySelector('#enemy');
    if (enemy) {
        enemy.setAttribute('gltf-model', 'https://cdn.glitch.global/15d883af-d2cb-46d5-ae7f-907d434c5fdf/scene6.gltf?v=1708541908551');
        enemy.setAttribute('scale', '0.005 0.005 0.005');
        enemy.setAttribute('position', '3 1.5 -4.5');
        showMessage("The Cat spell was cast perfectly");

    }
}

function transformBack() {
    const enemy = document.querySelector('#enemy');
    if (enemy) {
        enemy.setAttribute('gltf-model', 'https://cdn.glitch.global/15d883af-d2cb-46d5-ae7f-907d434c5fdf/scene3.gltf?v=1708490649261');
        enemy.setAttribute('scale', '0.008 0.008 0.008');
        enemy.setAttribute('position', '3 2.8 -4.5');
        showMessage("The Reverse spell was cast perfectly");

    }
}
  
function adjustWizardSize(scaleFactor) {
    const wizard = document.querySelector('#wizard');
    if (wizard) {
        wizard.setAttribute('scale', `${scaleFactor} ${scaleFactor} ${scaleFactor}`);
      
    }
}
  
function resetWizardSize() {
    const wizard = document.querySelector('#wizard');
    if (wizard) {
        // Reset the wizard's size to the original scale
        wizard.setAttribute('scale', "0.01 0.01 0.01");
    }
}
  
function showMessage(message) {
    const sceneEl = document.querySelector('a-scene');
    const messageEl = document.createElement('a-entity'); // Container for text and background

    // Create background with padding effect
    const backgroundEl = document.createElement('a-plane');
    backgroundEl.setAttribute('color', '#000'); // Background color
    backgroundEl.setAttribute('height', '0.5'); // Height of the background
    backgroundEl.setAttribute('width', '7'); // Width of the background, adjust based on text length
    backgroundEl.setAttribute('opacity', '0.8'); // Adjust for desired transparency
    backgroundEl.setAttribute('position', '0 0 -0.01'); // Slightly behind the text for 3D effect

    // Create text element
    const textEl = document.createElement('a-text');
    textEl.setAttribute('value', message);
    textEl.setAttribute('color', '#FFFFFF');
    textEl.setAttribute('align', 'center');
    textEl.setAttribute('width', '6'); // Adjust based on the length of the message

    // Add text and background to the container entity
    messageEl.appendChild(backgroundEl);
    messageEl.appendChild(textEl);

    // Position the message container in the scene
    messageEl.setAttribute('position', '0 2.5 -4'); // Adjust position as needed

    sceneEl.appendChild(messageEl);

    // Remove the message after 3 seconds
    setTimeout(() => {
        sceneEl.removeChild(messageEl);
    }, 3000);
}
  





function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}
  
</script>
</head>
  
<body>
    <a-scene>
        <!-- Enhanced Sky -->
        <a-sky color="#6EBAA7"></a-sky>
        
        <!-- Land (Ground) -->
        <a-plane position="0 0 -4" rotation="-90 0 0" width="50" height="50" color="#7CFC00"></a-plane>
        
        <!-- Wizard Object -->
        <a-gltf-model id="wizard" src="https://cdn.glitch.global/15d883af-d2cb-46d5-ae7f-907d434c5fdf/scene4.gltf?v=1708491695820" position="-2 1 -4" rotation="0 0 0" scale="0.01 0.01 0.01" animation-mixer></a-gltf-model>
        
        <!-- Enemy Object -->
        <a-gltf-model id="enemy" src="https://cdn.glitch.global/15d883af-d2cb-46d5-ae7f-907d434c5fdf/scene3.gltf?v=1708490649261" position="3 2.8 -4.5" rotation="0 0 0" scale="0.008 0.008 0.008" animation-mixer></a-gltf-model>
        
        <a-camera>
            <a-cursor color="#4CC3D9"></a-cursor>
        </a-camera>
      
      <a-entity position="-1 3 -4">
    <a-plane position="1.5 0.5 0" rotation="0 0 0" width="4" height="2.5" color="#222222" opacity="0.8"></a-plane>
    <a-text value="Shout any spell name to activate:" align="center" color="#FFFFFF" width="4" position="1.5 1.5 0.1"></a-text>
    <a-text value="Cast on Enemy Spells:" align="center" color="#FFFFFF" width="4" position="0.4 1 0.1"></a-text>
    <a-text value="- Dog Spell" align="center" color="#FFFFFF" width="4" position="0 0.8 0.1"></a-text>
    <a-text value="- Cat Spell" align="center" color="#FFFFFF" width="4" position="0 0.6 0.1"></a-text>
    <a-text value="- Reverse Spell" align="center" color="#FFFFFF" width="4" position="0 -0.6 0.1"></a-text>
    <a-text value="Cast on Wizard Spells:" align="center" color="#FFFFFF" width="4" position="0 -0.9 0.1"></a-text>
    <a-text value="- Shrink Spell" align="center" color="#FFFFFF" width="4" position="0 -1.2 0.1"></a-text>
    <a-text value="- Grow Spell" align="center" color="#FFFFFF" width="4" position="0 -1.5 0.1"></a-text>
    <a-text value="- Normal Size Spell" align="center" color="#FFFFFF" width="4" position="0 -1.8 0.1"></a-text>
</a-entity>

    </a-scene>
</body>
</html>
